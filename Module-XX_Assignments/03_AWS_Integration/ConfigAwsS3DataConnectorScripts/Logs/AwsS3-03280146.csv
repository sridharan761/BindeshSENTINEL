"Time","Message","Severity"
"28-03-2024 01:46","Starting ConfigAwsConnector at: 03/28/2024 01:46:45","Information"
"28-03-2024 01:46","Log created: C:\Users\ServerX\Downloads\ConfigAwsS3DataConnectorScripts\Logs\AwsS3-03280146.csv","Information"
"28-03-2024 01:46","To begin you will choose the AWS logs to configure.","Information"
"28-03-2024 01:47","Checking AWS CLI configuration...","Information"
"28-03-2024 01:47","Starting CloudTrail data connector configuration script","Verbose"
"28-03-2024 01:47","This script creates an Assume Role with minimal permissions to grant Azure Sentinel access to your logs in a designated S3 bucket & SQS of your choice, enable CloudTrail Logs, S3 bucket, SQS Queue, and S3 notifications.","Information"
"28-03-2024 01:47","Notes:","Information"
"28-03-2024 01:47","* You can find more information about the script in https://github.com/Azure/Azure-Sentinel/blob/master/DataConnectors/AWS-S3/README.md","Information"
"28-03-2024 01:47","* If a resource name(like: S3, Sqs, Kms) already exists, the script will use the available one and not create a new resource","Information"
"28-03-2024 01:47","Checking existing OIDC provider","Information"
"28-03-2024 01:47","Executing Set-RetryAction","Verbose"
"28-03-2024 01:47","Executing: aws sts get-caller-identity --query 'Account' --output text","Verbose"
"28-03-2024 01:47","154511248558","Verbose"
"28-03-2024 01:47","Executing: aws iam get-open-id-connect-provider --open-id-connect-provider-arn 'arn:aws:iam::154511248558:oidc-provider/sts.windows.net/33e01921-4d64-4f8c-a055-5bdaffd5e33d/' 2>&1","Verbose"
"28-03-2024 01:47","System.Management.Automation.RemoteException An error occurred (NoSuchEntity) when calling the GetOpenIDConnectProvider operation: OpenIDConnect Provider not found for arn arn:aws:iam::154511248558:oidc-provider/sts.windows.net/33e01921-4d64-4f8c-a055-5bdaffd5e33d/","Verbose"
"28-03-2024 01:47","Creating OpenID Connect provider","Information"
"28-03-2024 01:47","Executing Set-RetryAction","Verbose"
"28-03-2024 01:47","Executing: aws iam create-open-id-connect-provider --url 'https://sts.windows.net/33e01921-4d64-4f8c-a055-5bdaffd5e33d/' --ThumbprintList '626d44e704d1ceabe3bf0d53397464ac8080142c' --client-id-list api://1462b192-27f7-4cb9-8523-0f4ecb54b47e 2>&1","Verbose"
"28-03-2024 01:47","{     ""OpenIDConnectProviderArn"": ""arn:aws:iam::154511248558:oidc-provider/sts.windows.net/33e01921-4d64-4f8c-a055-5bdaffd5e33d/"" }","Verbose"
"28-03-2024 01:47","OpenID Connect provider created successfully","Information"
"28-03-2024 01:47","Assume role definition","Information"
"28-03-2024 01:47","Executing Set-RetryAction","Verbose"
"28-03-2024 01:48","Executing: aws iam get-role --role-name AzSentinelRole 2>&1| Out-Null","Verbose"
"28-03-2024 01:48","Using role name: OIDC_AzSentinelRole with OIDC prefix because OpenID Connect authentication is being used.","Information"
"28-03-2024 01:48","You must specify the the Azure Sentinel Workspace ID. This is found in the Azure Sentinel portal.","Information"
"28-03-2024 01:50","Using Azure Sentinel Workspace ID: cd5aca79-ae5d-48d3-bed9-2dfb4d2044f1","Information"
"28-03-2024 01:50","Executing: aws iam create-role --role-name OIDC_AzSentinelRole --assume-role-policy-document {
            \""Version\"": \""2012-10-17\"",
            \""Statement\"": [
                {
                    \""Effect\"": \""Allow\"",
					\""Principal\"": {
						\""Federated\"": \""arn:aws:iam::154511248558:oidc-provider/sts.windows.net/33e01921-4d64-4f8c-a055-5bdaffd5e33d/\""
					},
                    \""Action\"": \""sts:AssumeRoleWithWebIdentity\"",
					\""Condition\"": {
						\""StringEquals\"": {
							\""sts.windows.net/33e01921-4d64-4f8c-a055-5bdaffd5e33d/:aud\"": \""api://1462b192-27f7-4cb9-8523-0f4ecb54b47e\"",
							\""sts:RoleSessionName\"": \""MicrosoftSentinel_cd5aca79-ae5d-48d3-bed9-2dfb4d2044f1\""
						}
					}
                }
            ]
        } --tags {\""Key\"": \""Operator\"", \""Value\"": \""Microsoft_Sentinel_Automation_Script\""} 2>&1","Verbose"
"28-03-2024 01:50","System.Management.Automation.RemoteException Error parsing parameter '--tags': Invalid JSON: Expecting property name enclosed in double quotes: line 1 column 3 (char 2) JSON received: [{\""Key\"": \""Operator\"", \""Value\"": \""Microsoft_Sentinel_Automation_Script\""}]","Verbose"
"28-03-2024 01:50","File C:\Users\ServerX\Downloads\ConfigAwsS3DataConnectorScripts\ConfigAwsConnector.ps1 cannot be loaded. The file C:\Users\ServerX\Downloads\ConfigAwsS3DataConnectorScripts\ConfigAwsConnector.ps1 is not digitally signed. You cannot run this script on the current system. For more information about running scripts and setting execution policy, see about_Execution_Policies at https://go.microsoft.com/fwlink/?LinkID=135170.","Error"
"28-03-2024 01:50","Retrying...","Information"
"28-03-2024 01:57","Executing: aws iam get-role --role-name AzureSentinelRole 2>&1| Out-Null","Verbose"
"28-03-2024 01:57","Executing: aws iam get-role --role-name AzureSentinelRole","Verbose"
"28-03-2024 01:57","arn:aws:iam::154511248558:role/AzureSentinelRole","Verbose"
"28-03-2024 01:57","Using S3 Bucket name: binsentinellabbucket","Information"
"28-03-2024 01:57","current region configuration: ap-southeast-1","Verbose"
"28-03-2024 01:57","Executing: aws s3api head-bucket --bucket binsentinellabbucket 2>&1","Verbose"
"28-03-2024 01:58","output System.Management.Automation.RemoteException An error occurred (404) when calling the HeadBucket operation: Not Found 2>&1","Verbose"
"28-03-2024 01:58","error code 254 2>&1","Verbose"
"28-03-2024 01:58","Creating new bucket: y ","Information"
"28-03-2024 01:58","Executing: aws s3api create-bucket --bucket binsentinellabbucket --create-bucket-configuration LocationConstraint=ap-southeast-1 2>&1","Verbose"
"28-03-2024 01:58","{     ""Location"": ""http://binsentinellabbucket.s3.amazonaws.com/"" }","Verbose"
"28-03-2024 01:58","S3 Bucket binsentinellabbucket created successfully","Information"
"28-03-2024 01:58","Executing: aws s3api put-bucket-tagging --bucket binsentinellabbucket --tagging  ""{\""TagSet\"":[{\""Key\"": \""Operator\"", \""Value\"": \""Microsoft_Sentinel_Automation_Script\""}]}""","Verbose"
"28-03-2024 01:58","File C:\Users\ServerX\Downloads\ConfigAwsS3DataConnectorScripts\ConfigAwsConnector.ps1 cannot be loaded. The file C:\Users\ServerX\Downloads\ConfigAwsS3DataConnectorScripts\ConfigAwsConnector.ps1 is not digitally signed. You cannot run this script on the current system. For more information about running scripts and setting execution policy, see about_Execution_Policies at https://go.microsoft.com/fwlink/?LinkID=135170.","Error"
"28-03-2024 01:58","Retrying...","Information"
"28-03-2024 01:58","Using S3 Bucket name: binsentinellabbucket","Information"
"28-03-2024 01:58","current region configuration: ap-southeast-1","Verbose"
"28-03-2024 01:58","Executing: aws s3api head-bucket --bucket binsentinellabbucket 2>&1","Verbose"
"28-03-2024 01:58","output  2>&1","Verbose"
"28-03-2024 01:58","error code 0 2>&1","Verbose"
"28-03-2024 01:58","Executing: (aws sts get-caller-identity | ConvertFrom-Json).Account","Verbose"
"28-03-2024 01:58","154511248558","Verbose"
"28-03-2024 01:58","Executing: (aws sts get-caller-identity | ConvertFrom-Json).Account","Verbose"
"28-03-2024 01:58","154511248558","Verbose"
"28-03-2024 01:58","Creating SQS queue:","Information"
"28-03-2024 01:59","Using Sqs name: binsentinelqueue","Information"
"28-03-2024 01:59","Executing: aws sqs create-queue --queue-name binsentinelqueue --tags {\""Operator\"": \""Microsoft_Sentinel_Automation_Script\""} 2>&1","Verbose"
"28-03-2024 01:59","System.Management.Automation.RemoteException Error parsing parameter '--tags': Invalid JSON: Expecting property name enclosed in double quotes: line 1 column 2 (char 1) JSON received: {\""Operator\"": \""Microsoft_Sentinel_Automation_Script\""}","Verbose"
"28-03-2024 01:59","File C:\Users\ServerX\Downloads\ConfigAwsS3DataConnectorScripts\ConfigAwsConnector.ps1 cannot be loaded. The file C:\Users\ServerX\Downloads\ConfigAwsS3DataConnectorScripts\ConfigAwsConnector.ps1 is not digitally signed. You cannot run this script on the current system. For more information about running scripts and setting execution policy, see about_Execution_Policies at https://go.microsoft.com/fwlink/?LinkID=135170.","Error"
"28-03-2024 01:59","Retrying...","Information"
"28-03-2024 02:07","Using Sqs name: sentinelqueue","Information"
"28-03-2024 02:07","Executing: aws sqs create-queue --queue-name sentinelqueue --tags {\""Operator\"": \""Microsoft_Sentinel_Automation_Script\""} 2>&1","Verbose"
"28-03-2024 02:07","System.Management.Automation.RemoteException Error parsing parameter '--tags': Invalid JSON: Expecting property name enclosed in double quotes: line 1 column 2 (char 1) JSON received: {\""Operator\"": \""Microsoft_Sentinel_Automation_Script\""}","Verbose"
"28-03-2024 02:07","File C:\Users\ServerX\Downloads\ConfigAwsS3DataConnectorScripts\ConfigAwsConnector.ps1 cannot be loaded. The file C:\Users\ServerX\Downloads\ConfigAwsS3DataConnectorScripts\ConfigAwsConnector.ps1 is not digitally signed. You cannot run this script on the current system. For more information about running scripts and setting execution policy, see about_Execution_Policies at https://go.microsoft.com/fwlink/?LinkID=135170.","Error"
"28-03-2024 02:07","Retrying...","Information"
"28-03-2024 02:07","Using Sqs name: sentinelqueue","Information"
"28-03-2024 02:07","Executing: aws sqs create-queue --queue-name sentinelqueue --tags {\""Operator\"": \""Microsoft_Sentinel_Automation_Script\""} 2>&1","Verbose"
"28-03-2024 02:07","System.Management.Automation.RemoteException Error parsing parameter '--tags': Invalid JSON: Expecting property name enclosed in double quotes: line 1 column 2 (char 1) JSON received: {\""Operator\"": \""Microsoft_Sentinel_Automation_Script\""}","Verbose"
"28-03-2024 02:07","File C:\Users\ServerX\Downloads\ConfigAwsS3DataConnectorScripts\ConfigAwsConnector.ps1 cannot be loaded. The file C:\Users\ServerX\Downloads\ConfigAwsS3DataConnectorScripts\ConfigAwsConnector.ps1 is not digitally signed. You cannot run this script on the current system. For more information about running scripts and setting execution policy, see about_Execution_Policies at https://go.microsoft.com/fwlink/?LinkID=135170.","Error"
"28-03-2024 02:07","Action was unsuccessful after 3 attempts. Please review the errors and try again.","Error"
